<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcane Chamber - An Immersive Text Adventure</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;700&family=Source+Sans+Pro:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen">
        <div class="loading-text" aria-live="polite">Arcane Chamber</div>
        <div class="loading-dots" aria-hidden="true">
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
        </div>
    </div>

    <!-- Notifications Area -->
    <div id="notifications" class="fixed top-5 right-5 z-50" {{ aria-live="polite" }}></div>

    <!-- Sidebar Toggle Button -->
    <div class="sidebar-toggle" aria-label="Open menu" id="sidebar-toggle-btn">
        <i class="fas fa-bars"></i>
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar-menu">
        <div class="sidebar-header">
            <div class="sidebar-title">Oracle</div> <!-- Renamed Menu -->
            <button class="sidebar-close" aria-label="Close menu" id="sidebar-close-btn">&times;</button>
        </div>
        <div class="sidebar-content">
            <button class="btn btn-secondary w-full mb-2" id="btn-save-game">
                <i class="fas fa-save mr-2"></i> Inscribe Moment (Save)
            </button>
            <button class="btn btn-secondary w-full mb-2" id="btn-load-game">
                <i class="fas fa-folder-open mr-2"></i> Recall Moment (Load)
            </button>
            <button class="btn btn-secondary w-full mb-2" id="btn-settings">
                <i class="fas fa-cog mr-2"></i> Adjust Reality (Settings)
            </button>
            <button class="btn btn-secondary w-full mb-2" id="btn-achievements">
                <i class="fas fa-star mr-2"></i> Echoes of Fate (Achievements)
            </button>
             <button class="btn btn-secondary w-full mb-2" id="btn-grimoire">
                 <i class="fas fa-book-open mr-2"></i> Grimoire (Spells/Info) <!-- New Button Stub -->
             </button>
            <button class="btn btn-danger w-full mb-2 mt-4" id="btn-restart">
                <i class="fas fa-redo mr-2"></i> Unravel Reality (Restart)
            </button>
        </div>
    </div>

    <!-- Main Game Container -->
    <div class="container mx-auto p-4" id="game-container">
        <!-- Start Screen -->
        <div id="start-screen" class="text-center py-16">
            <h1 class="text-4xl mb-8 mana-active">Arcane Chamber</h1>
            <p class="mb-8 text-xl max-w-lg mx-auto text-gray-400">You float in a silent, featureless void. A faint, inner warmth is all you perceive. Your thoughts feel sluggish, contained.</p>
            <button id="btn-start-game" class="btn btn-primary text-lg px-8 py-4 shimmer-effect">
                Focus <span class="keybinding">Enter</span>
            </button>
        </div>

        <!-- Main Game Area (Initially Hidden) -->
        <div id="main-game" class="hidden">
            <!-- Chamber Description Area -->
            <div class="mb-6">
                <div class="room" id="chamber-room"> <!-- Changed ID -->
                    <div class="room-title" id="chamber-title">Featureless Void</div> <!-- Changed ID -->
                    <div class="room-description" id="chamber-description">The void presses in. Only a faint inner warmth persists.</div> <!-- Changed ID -->
                    <div id="chamber-choices" class="choice-container"></div> <!-- Changed ID -->
                    <div class="rune-glow-effect"></div> <!-- Changed class -->
                </div>
            </div>

            <!-- Tabbed Interface -->
            <div class="tab-container">
                <div class="tab-buttons" role="tablist">
                    <div class="tab-button active" data-tab="resources" role="tab" aria-selected="true" aria-controls="tab-resources">Essence</div>
                    <div class="tab-button" data-tab="nexus" role="tab" aria-selected="false" aria-controls="tab-nexus">Nexus</div>
                    <div class="tab-button" data-tab="exploration" role="tab" aria-selected="false" aria-controls="tab-exploration">Void Walk</div>
                    <div class="tab-button" data-tab="infusion" role="tab" aria-selected="false" aria-controls="tab-infusion">Infusion</div>
                    <div class="tab-button" data-tab="spells" role="tab" aria-selected="false" aria-controls="tab-spells">Spells</div>
                    <div class="tab-button" data-tab="research" role="tab" aria-selected="false" aria-controls="tab-research">Research</div>
                    <div class="tab-button" data-tab="events" role="tab" aria-selected="false" aria-controls="tab-events">Echoes</div>
                </div>

                <!-- Resources Tab -->
                <div class="tab-content active" id="tab-resources" role="tabpanel" aria-labelledby="tab-button-resources">
                     <div id="resources-container" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <!-- Resources will be dynamically added here -->
                        <div class="resource-container placeholder" data-resource="mana_motes">
                            <div class="flex justify-between items-center">
                                <div class="resource-name">
                                    <i class="fas fa-sparkles" style="color: var(--mana-motes-color)"></i> Mana Motes
                                </div>
                                <div class="resource-value">0</div>
                            </div>
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <div>+<span id="mana_motes-income">0</span>/s</div>
                                <div><span id="mana_motes-storage">100</span> max</div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 flex gap-4">
                        <button id="btn-gather-motes" class="btn btn-primary">
                            Gather Motes <span class="keybinding">G</span>
                        </button>
                        <button id="btn-channel-mana" class="btn btn-secondary">
                            Channel Mana <span class="keybinding">C</span>
                        </button>
                    </div>
                </div>

                <!-- Nexus Tab -->
                <div class="tab-content" id="tab-nexus" role="tabpanel" aria-labelledby="tab-button-nexus">
                     <div id="nexus-constructs" class="mb-6">
                         <div class="text-lg mb-2">Nexus Constructs</div>
                         <div id="constructs-container" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                              <!-- Constructs will be dynamically added here -->
                              <p class="text-gray-500 text-sm italic">The Nexus is dormant. Focus your will to shape reality.</p>
                         </div>
                     </div>

                     <div id="nexus-attunement" class="mb-6">
                         <div class="text-lg mb-2">Attuned Souls (<span id="population">0</span>/<span id="max-population">0</span>)</div> <!-- Kept population concept for now -->
                         <div class="progress-container">
                             <div class="progress-bar" id="population-bar" style="width: 0%"></div>
                         </div>
                         <div id="attunement-container" class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-4">
                             <!-- Worker assignment replacement -->
                             <p class="text-gray-500 text-sm italic">No souls are currently attuned to tasks.</p>
                         </div>
                     </div>
                </div>

                <!-- Exploration Tab -->
                <div class="tab-content" id="tab-exploration" role="tabpanel" aria-labelledby="tab-button-exploration">
                     <div class="flex flex-col md:flex-row gap-6">
                         <!-- Map Area -->
                         <div class="flex-1">
                             <button id="btn-toggle-map" class="btn btn-secondary mb-3">
                                 <i class="fas fa-map-marked-alt mr-2"></i> Toggle Void Map
                             </button>
                             <div id="map-container" class="map-container">
                                 <div id="map-grid" class="map-grid"></div>
                             </div>
                         </div>

                         <!-- Status & Actions Area -->
                         <div class="w-full md:w-1/3">
                            <div id="exploration-status" class="mb-4 p-4 border border-gray-700 rounded bg-black bg-opacity-10">
                                 <div class="text-lg mb-2 font-semibold">Current Locus: <span id="current-location" class="text-primary-color">Nexus Core</span></div>
                                 <div id="location-description" class="mb-3 text-gray-400 text-sm">The central point of your manifested reality. Relatively stable.</div>
                                 <div id="exploration-buttons">
                                     <button id="btn-explore" class="btn btn-primary mb-2 mr-2">
                                         Probe the Void <span class="keybinding">X</span>
                                     </button>
                                     <button id="btn-return-nexus" class="btn btn-secondary mb-2 hidden"> <!-- Initially hidden -->
                                         Return to Nexus <span class="keybinding">N</span>
                                     </button>
                                 </div>
                             </div>
                             <!-- Encounter Area -->
                             <div id="exploration-encounter" style="display: none;">
                                 <div class="combat-container">
                                     <div id="combat-enemy-container"></div>
                                     <div id="combat-actions" class="combat-actions">
                                         <button class="btn btn-danger" data-action="attack">
                                             Arcane Bolt <span class="keybinding">A</span>
                                         </button>
                                         <button class="btn btn-secondary" data-action="defend">
                                             Mana Shield <span class="keybinding">D</span>
                                         </button>
                                         <button class="btn btn-primary" data-action="spell">
                                             Cast Spell <span class="keybinding">S</span> <!-- Changed Special -->
                                         </button>
                                         <button class="btn btn-success" data-action="item">
                                             Use Conduit <span class="keybinding">I</span> <!-- Changed Item -->
                                         </button>
                                         <button class="btn btn-secondary" data-action="flee">
                                             Phase Out <span class="keybinding">R</span> <!-- Changed Flee -->
                                         </button>
                                     </div>
                                     <div class="combat-log" id="combat-log" {{ aria-live="polite" role="log" }}></div>
                                 </div>
                             </div>
                         </div>
                     </div>
                 </div>

                <!-- Infusion Tab -->
                <div class="tab-content" id="tab-infusion" role="tabpanel" aria-labelledby="tab-button-infusion">
                    <div class="text-lg mb-3">Infusion Altar</div>
                    <div id="infusion-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                         <!-- Infusable items/recipes will be added here -->
                         <p class="text-gray-500 text-sm italic">The Altar awaits patterns and essence.</p>
                    </div>
                </div>

                <!-- Spells Tab (Stub) -->
                 <div class="tab-content" id="tab-spells" role="tabpanel" aria-labelledby="tab-button-spells">
                     <div class="text-lg mb-3">Known Incantations</div>
                     <div id="spells-container">
                         <p class="text-gray-400 italic">Your mind is blank. Seek knowledge or inspiration.</p>
                         <!-- Spell list and casting interface would go here -->
                     </div>
                 </div>

                 <!-- Research Tab (Stub) -->
                 <div class="tab-content" id="tab-research" role="tabpanel" aria-labelledby="tab-button-research">
                     <div class="text-lg mb-3">Arcane Research</div>
                     <div id="research-container">
                         <p class="text-gray-400 italic">Unravel the mysteries of the chamber and the void.</p>
                         <!-- Research tree / projects would go here -->
                         <div class="mt-4 p-3 border border-dashed border-gray-600 rounded">
                            <h4 class="font-semibold text-secondary-color mb-2">Example Research Project (Stub)</h4>
                            <p class="text-sm mb-2">Unlock Basic Runic Sight</p>
                            <div class="flex text-xs gap-2 mb-2"><span>Cost:</span><span>10 Motes</span><span>5 Ether</span></div>
                            <div class="progress-container"><div class="progress-bar research" style="width: 30%"></div></div>
                            <button class="btn btn-sm btn-success mt-2 btn-disabled" disabled>Research</button>
                         </div>
                     </div>
                 </div>

                <!-- Events Tab -->
                <div class="tab-content" id="tab-events" role="tabpanel" aria-labelledby="tab-button-events">
                    <div class="text-lg mb-3">Echoes of Time</div>
                    <div class="event-log" id="event-log" {{ aria-live="polite" role="log" }}>
                        <!-- Event log messages will appear here -->
                    </div>
                </div>
            </div>
        </div> <!-- End Main Game -->
    </div> <!-- End Container -->

    <!-- Modals -->
    <div class="modal-backdrop" id="settings-modal">
        <div class="modal-content"> <div class="modal-header"> <div class="modal-title">Adjust Reality</div> <button class="modal-close" data-close-modal>&times;</button> </div> <div class="modal-body"> <!-- Settings Rows --> <div class="settings-row"> <div class="settings-label">Auditory Echoes (SFX)</div> <label class="toggle-switch"> <input type="checkbox" id="toggle-sound-effects" checked> <span class="toggle-slider round"></span> </label> </div> <div class="settings-row"> <div class="settings-label">Ambient Resonance (Music)</div> <label class="toggle-switch"> <input type="checkbox" id="toggle-music" checked> <span class="toggle-slider round"></span> </label> </div> <div class="settings-row"> <div class="settings-label">Resonance Level (Volume)</div> <div class="volume-control"> <input type="range" min="0" max="100" value="70" class="volume-slider" id="volume-slider"> <span class="ml-3 text-sm" id="volume-value">70%</span> </div> </div> <div class="settings-row"> <div class="settings-label">Theme Preference</div> <select id="setting-theme" class="bg-gray-700 text-white p-1 rounded border border-gray-600"> <option value="dark">Mystic Dark</option> <option value="light">Arcane Light</option> <option value="system">Use System</option> </select> </div> <div class="settings-row"> <div class="settings-label"> Stark Contrast Mode</div> <label class="toggle-switch"> <input type="checkbox" id="toggle-high-contrast"> <span class="toggle-slider round"></span> </label> </div> <div class="settings-row"> <div class="settings-label"> Oracular Vision (Screen Reader)</div> <label class="toggle-switch"> <input type="checkbox" id="toggle-screen-reader"> <span class="toggle-slider round"></span> </label> </div> <div class="settings-row"> <div class="settings-label"> Manifest Visuals</div> <label class="toggle-switch"> <input type="checkbox" id="toggle-visual-effects" checked> <span class="toggle-slider round"></span> </label> </div> <div class="settings-row"> <div class="settings-label"> Auto-Inscribe Moments</div> <label class="toggle-switch"> <input type="checkbox" id="toggle-autosave" checked> <span class="toggle-slider round"></span> </label> </div> </div> <div class="modal-footer"> <button class="btn btn-secondary" data-close-modal>Seal Changes</button> </div> </div>
    </div>
    <div class="modal-backdrop" id="save-modal">
         <div class="modal-content"> <div class="modal-header"> <div class="modal-title">Inscribe Moment</div> <button class="modal-close" data-close-modal>&times;</button> </div> <div class="modal-body"> <p class="mb-4 text-sm text-gray-400">Choose a memory slot to inscribe the current reality.</p> <div id="save-slots" class="space-y-2"> <!-- Save slots loaded here --> </div> </div> <div class="modal-footer"> <button class="btn btn-secondary" data-close-modal>Cancel</button> </div> </div>
    </div>
    <div class="modal-backdrop" id="load-modal">
         <div class="modal-content"> <div class="modal-header"> <div class="modal-title">Recall Moment</div> <button class="modal-close" data-close-modal>&times;</button> </div> <div class="modal-body"> <p class="mb-4 text-sm text-gray-400">Choose a memory to recall and reshape reality.</p> <div id="load-slots" class="space-y-2"> <!-- Load slots loaded here --> </div> </div> <div class="modal-footer"> <button class="btn btn-secondary" data-close-modal>Cancel</button> </div> </div>
    </div>
    <div class="modal-backdrop" id="achievements-modal">
         <div class="modal-content"> <div class="modal-header"> <div class="modal-title">Echoes of Fate</div> <button class="modal-close" data-close-modal>&times;</button> </div> <div class="modal-body"> <div id="achievements-container" class="space-y-3"> <!-- Achievements loaded here --> </div> </div> <div class="modal-footer"> <button class="btn btn-secondary" data-close-modal>Close</button> </div> </div>
    </div>
    <div class="modal-backdrop" id="restart-modal">
        <div class="modal-content"> <div class="modal-header"> <div class="modal-title text-danger-color">Unravel Reality?</div> <button class="modal-close" data-close-modal>&times;</button> </div> <div class="modal-body"> <p>Are you certain you wish to unravel this timeline? All progress since the last inscription will be lost to the void.</p> </div> <div class="modal-footer"> <button class="btn btn-danger" id="btn-restart-confirm">Unravel</button> <button class="btn btn-secondary" data-close-modal>Cancel</button> </div> </div>
    </div>
     <div class="modal-backdrop" id="grimoire-modal"> <!-- Grimoire Modal Stub -->
         <div class="modal-content"> <div class="modal-header"> <div class="modal-title">Grimoire</div> <button class="modal-close" data-close-modal>&times;</button> </div> <div class="modal-body"> <p class="text-gray-400 italic">Pages lie empty, waiting for knowledge...</p> <!-- Spells, lore, bestiary etc. could go here --> </div> <div class="modal-footer"> <button class="btn btn-secondary" data-close-modal>Close</button> </div> </div>
     </div>


    <script src="game.js" defer></script>

</body>
</html>